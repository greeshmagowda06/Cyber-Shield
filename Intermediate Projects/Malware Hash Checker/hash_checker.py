import hashlib
import os

def get_file_hash(filename):
    hash_func = hashlib.sha256()
    with open(filename, "rb") as file:
        for chunk in iter(lambda: file.read(4096), b""):
            hash_func.update(chunk)
    return hash_func.hexdigest()

def check_malware(filename):
    file_hash = get_file_hash(filename)
    
    # Get the directory where this script is located
    script_dir = os.path.dirname(os.path.abspath(__file__))
    hash_db_path = os.path.join(script_dir, "known_hashes.txt")
    
    try:
        with open(hash_db_path, "r") as f:
            malware_db = {}
            for line in f:
                line = line.strip()
                if line and not line.startswith('#'):
                    parts = line.split('|')
                    if len(parts) >= 2:
                        hash_value = parts[0].lower()
                        malware_name = parts[1]
                        description = parts[2] if len(parts) > 2 else "No description available"
                        malware_db[hash_value] = (malware_name, description)
                    else:
                        # Handle old format (hash only)
                        malware_db[line.lower()] = ("Unknown Malware", "Legacy hash entry")

        if file_hash in malware_db:
            malware_name, description = malware_db[file_hash]
            print(f"\n⚠️ WARNING: MALWARE DETECTED!")
            print(f"File: {filename}")
            print(f"Identified as: {malware_name}")
            print(f"Description: {description}")
            print(f"Hash (SHA256): {file_hash}")
        else:
            print(f"\n✅ File appears clean: {filename}")
            print(f"Hash (SHA256): {file_hash}")
            print("\nNote: This does not guarantee the file is safe.")
            print("Always exercise caution with unknown files.")
    except FileNotFoundError:
        print(f"\nError: Database file not found: {hash_db_path}")
        print("Please ensure 'known_hashes.txt' exists in the same directory as this script.")

if __name__ == "__main__":
    print("Malware Hash Checker")
    file = input("Enter the path to the file you want to check (e.g., C:\\path\\to\\your\\file.exe): ")
    check_malware(file)
